using OrthogonalPolynomials
using Base.Test, Base.Math

# write your own tests here

# Hand Implementation
L0(x) = 1.0
L1(x) = -x + 1.0
L2(x) = .5 * (x^2 - 4x + 2)
L3(x) = (1/6)*(-x^3 +9x^2 -18x + 6)
L4(x) = (1/24)*(x^4 - 16x^3 + 72x^2 - 96x + 24)
L5(x) = (1/120)*(-x^5 + 25x^4 -200x^3 + 600x^2 - 600x + 120)
L6(x) = (1/720)*(x^6 - 36x^5 + 450x^4 - 2400x^3 + 5400x^2 - 4320x + 720)
L7(x) = (1/5040)*(-x^7 + 49x^6 - 882x^5 + 7350x^4 - 29_400x^3 + 52_920x^2 - 35_280x + 5040)
L8(x) = (1/40320)*(x^8 - 64x^7 + 1568x^6 - 18_816x^5 + 117_600x^4 - 376_320x^3 + 564_480x^2 - 322_560x + 40320)
L9(x) = (1/362880)*(-x^9 + 81x^8 - 2592x^7 + 42_336x^6 - 381_024x^5 + 1_905_120x^4 - 5_080_320x^3 + 6_531_840x^2 - 3_265_920x + 362_880)
L10(x) = (1/3628800)*(x^10 - 100x^9 + 4_050x^8 - 86_400x^7 + 1_058_400x^6 - 7_620_480x^5 + 31_752_000x^4 - 72_576_000x^3  + 81_648_000x^2 - 36_288_000x + 3_628_800)
L11(x) = (1/39916800)*(-x^11 + 121x^10 - 6_050x^9 + 163_350x^8 - 2_613_600x^7 + 25_613_280x^6 - 153_679_680x^5 + 548_856_000x^4 - 1_097_712_000x^3 + 1_097_712_000x^2 - 439_084_800x + 39_916_800)
L12(x) = (1/479001600)*(x^12 - 144x^11 + 8_712x^10 - 290_400x^9 + 5_880_600x^8 - 75_271_680x^7 + 614_718_720x^6 - 3_161_410_560x^5 + 9_879_408_000x^4 - 17_563_392_000x^3 + 15_807_052_800x^2 - 5_748_019_200x + 479_001_600)

Ls = [L0, L1, L2, L3, L4, L5, L6, L7, L8, L9, L10, L11, L12]

# Naive implemenatation
"Credit to @yingboma"
function laguerre(n, x)

    l0, l1 = 1, 1-x
    for k in 1:n-1
        l0, l1 = l1, ( (2k+1-x)*l1 - k*l0 )/(k+1)
    end
    l1
end

# Correct 0 implemenatation
"Credit to @yingboma"
function laguerre_corrected(n, x)

    n == 0 ? (return 1) : nothing

    l0, l1 = 1, 1-x
    for k in 1:n-1
        l0, l1 = l1, ( (2k+1-x)*l1 - k*l0 )/(k+1)
    end
    l1
end

goal12(x) = @evalpoly x 1.0 -12.0 33.0 -36.666666666666664 20.625 -6.6 1.2833333333333334 -0.15714285714285714 0.012276785714285714 -0.0006062610229276896 1.8187830687830687e-5 -3.0062530062530064e-7


# Abramowitz and Stegun pg. 799
LaguerreTable = [
    1 1 1 2 6 24 120 720 5040 40320 362880 3628800 39916800 479001600;
    1 1 1 -4 -18 -96 -600 -4320 -35280 -322560 -3265920 -36288000 -439084800 -6748019200;
    2 2 -4 2 18 144 1200 10800 105840 1128960 13063680 163296000 2195424000 31614106600;
    6 6 -18 9 6 -96 -1200 -14400 -176400 -2257920 -30481920 -435456000 -6586272000 -105380352000;
    24 24 -96 72 -16 24 600 10800 176400 2822400 45722880 762048000 13172544000 237105792000;
    120 120 -600 600 -200 25 120 -4320 -106840 -2257920 -45722880 -914457600 -18441561600 -379369267200;
    720 720 -4320 5400 -2400 450 -36 720 35280 1128960 30481920 762048000 18441561600 442597478400;
    5040 5040 -35280 52920 -29400 7350 -882 49 5040 -322560 -13063680 -435456000 -13172544000 -379369267200;
    40320 40320 -322560 564480 -376320 117600 -18816 1568 -64 40320 3269520 163296000 6586272000 237105792000;
    362880 362880 -3265920 6531840 -5080320 1905120 -381024 42336 -2592 81 362880 -36288000 -2195424000 -105380352000;
    3623800 3628800 -36288000 81648000 -72576000 31752000 -7620480 1058400 -86400 4050 -100 3628800 439084800 31614106600;
    39916800 39916800 -439084800 1097712000 -1097712000 648806000 -103679680 25613280 -2613600 163350 -6050 121 39916800 -5748019200;
    479001600 479001600 -5748019200 15807052800 -17563392000 9879408000 -3161410560 614718720 -75271680 5880600 -290400 8712 -144 479001600]

#n\z is the first column
# Abramowitz and Stegun p. 800
testvals = [0. .5 1 3 5 10];
TestLaguerreTable = [
    0 1.0000000000 1.0000000000 1.0000000000 1.0000000000 1.0000000000;
    1 0.5000000000 0.0000000000 -2.0000000000 -4.0000000000 -9.0000000000;
    2 0.1250000000 -0.5000000000 -0.5000000000 3.5000000000 31.0000000000;
    3 -0.1458333333 -0.6666666667 1.0000000000 2.6666666667 -45.6666666667;
    4 -0.3307291667 -0.6250000000 1.3750000000 -1.2916666667 11.0000000000;
    5 -0.4455729167 -0.4666666667 0.8500000000 -3.1666666667 34.3333333333;
    6 -0.5041449653 -0.2569444444 -0.0125000000 -2.0902777778 -3.4444444444;
    7 -0.5183392237 -0.0404761905 -0.7464285714 0.3253968254 -30.9047619048;
    8 -0.4983629984 0.1539930556 -1.1087053571 2.2357390873 -16.3015873016;
    9 -0.4529195204 0.3097442681 -1.0611607143 2.6917438272 14.7918871252;
    10 -0.3893744141 0.4189459325 -0.7000223214 1.7562761795 27.9841269841;
    11 -0.3139072988 0.4801341791 -0.1807995130 0.1075436909 14.5369568703;
    12 -0.2316496389 0.4962122235 0.3403546063 -1.4486042948 -9.9037464593];

@testset "Base Table" begin
    @testset "Hand Implemenation" begin
        @test all(f(0) ≈ 1.0 for f in Ls)
        @test all(Ls[i](testvals[j]) ≈ TestLaguerreTable[i,j] for i in 1:13, j in 2:6)
    end
    @testset "Naive Implementation" begin
        @test all(laguerre(i,0.0) ≈ 1.0 for i in 0:12)
        @test_broken all([laguerre(i-1,testvals[j]) ≈ TestLaguerreTable[i,j] for i in 1:13, j in 2:6])
    end
    @testset "Naive Corrected" begin
        @test all(laguerre_corrected(i,0.0) ≈ 1.0 for i in 0:12)
        @test all([laguerre_corrected(i-1, testvals[j]) ≈ TestLaguerreTable[i,j] for i in 1:13, j in 2:6])
    end
    @testset "Stubborn Way" begin
        @test all(eval.(a(0,i)) .≈ 1 for i in 1:12)
        @test all(eval.([a(testvals[j],i) for i in 0:12, j in 2:6]) .≈ TestLaguerreTable[:,2:6])
    end
end

goal12(x) = @horner x 1.0 -12.0 33.0 -36.666666666666664 20.625 -6.6 1.2833333333333334 -0.15714285714285714 0.012276785714285714 -0.0006062610229276896 1.8187830687830687e-5 -3.0062530062530064e-7
